SELECT
    sJOB.name AS JobName,
    CASE
        WHEN sJOBH.run_status IS NULL THEN 'Running'
        WHEN sJOBH.run_status = 0 THEN 'Failed'
        WHEN sJOBH.run_status = 1 THEN 'Succeeded'
        WHEN sJOBH.run_status = 2 THEN 'Retry'
        WHEN sJOBH.run_status = 3 THEN 'Canceled'
        WHEN sJOBH.run_status = 4 THEN 'Running' -- In Progress
    END AS LastRunStatus
FROM msdb.dbo.sysjobs AS sJOB
LEFT JOIN (
    SELECT
        job_id,
        run_date,
        run_time,
        run_status,
        ROW_NUMBER() OVER (
            PARTITION BY job_id
            ORDER BY run_date DESC, run_time DESC
        ) AS RowNumber
    FROM msdb.dbo.sysjobhistory
    WHERE step_id = 0
      AND run_date = CONVERT(VARCHAR(8), GETDATE(), 112)
) AS sJOBH
    ON sJOB.job_id = sJOBH.job_id
   AND sJOBH.RowNumber = 1
LEFT JOIN BEST_Admin.dbo.TargetLoadDuration targ
    ON targ.JobName = sJOB.name
WHERE sJOB.name IN (
    SELECT JobName
    FROM BEST_Admin.dbo.TargetLoadDuration
    WHERE ShowInMail = 1
)
ORDER BY targ.SortColumn;
